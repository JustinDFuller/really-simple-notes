<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="It's notes, and they're simple." />
    <title>Really Simple Notes</title>
    <style>
      :root {
        --background: #202023;
        --background-hover: #2e2e33;
        --background-active: #31313b;
        --color: white;
        --color-secondary: #cfd0d3;
        --border: #141417;
        --font-size: 21px;
        --line-height: 36px;
      }

      * {
        box-sizing: border-box;
      }

      ul,
      li,
      div,
      div {
        width: 100%;
        display: block;
        margin: 0;
        padding: 0;
        border: 0;
      }

      html,
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji",
          "Segoe UI Symbol";
        padding: 0;
        margin: 0;
        height: 100vh;
        width: 100vw;
        font-size: var(--font-size);
        background: var(--background);
        color: var(--color);
      }

      #container {
        width: 100%;
        height: 100%;
        display: flex;
      }

      #sidebar {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        width: 20%;
        height: 94vh;
        margin: 0;
        padding: 0;
        border-right: 3px solid var(--border);
        margin-top: 55px;
      }

      #sidebar-icon {
        cursor: pointer;
        border-radius: 6px;
        background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iNzUycHQiIGhlaWdodD0iNzUycHQiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDc1MiA3NTIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiA8ZyBmaWxsPSIjY2ZjZmQyIj4KICA8cGF0aCBkPSJtMzA0LjMzIDIwOS40OGMtMTAuMTk5IDAtMTguNDE4IDguOTYwOS0xOC40MTggMjAuMDYydjQwLjM5MWMwIDExLjA5OCA4LjIxODggMjAuMDcgMTguNDE4IDIwLjA3aDI2My4xOGMxMC4xOTkgMCAxOC40MTgtOC45NzI3IDE4LjQxOC0yMC4wN3YtNDAuMzkxYzAtMTEuMTAyLTguMjIyNy0yMC4wNjItMTguNDE4LTIwLjA2MnoiLz4KICA8cGF0aCBkPSJtMzA0LjMzIDMzNS45NmMtMTAuMTk5IDAtMTguNDE4IDguOTQxNC0xOC40MTggMjAuMDd2NDAuMzcxYzAgMTEuMTI5IDguMjE4OCAyMC4wNTkgMTguNDE4IDIwLjA1OWgyNjMuMThjMTAuMTk5IDAgMTguNDE4LTguOTI5NyAxOC40MTgtMjAuMDU5di00MC4zNzFjMC0xMS4xMjktOC4yMjI3LTIwLjA3LTE4LjQxOC0yMC4wN3oiLz4KICA8cGF0aCBkPSJtMzA0LjMzIDQ2Mi40MWMtMTAuMTk5IDAtMTguNDE4IDguOTYwOS0xOC40MTggMjAuMDYydjQwLjM3MWMwIDExLjEyNSA4LjIxODggMjAuMDYyIDE4LjQxOCAyMC4wNjJoMjYzLjE4YzEwLjE5OSAwIDE4LjQxOC04Ljk0MTQgMTguNDE4LTIwLjA2MnYtNDAuMzcxYzAtMTEuMDk4LTguMjIyNy0yMC4wNjItMTguNDE4LTIwLjA2MnoiLz4KICA8cGF0aCBkPSJtMjA3LjU5IDQ2Mi40MWMtMTAuNjYgMC0yMC45MDYgNC4yNDYxLTI4LjQ3NyAxMS43ODUtNy41MzUyIDcuNTcwMy0xMS43NzcgMTcuNzg5LTExLjc3NyAyOC40NzMgMCAxMC42OTUgNC4yNDYxIDIwLjkxOCAxMS44MDkgMjguNDQ5IDcuNTQzIDcuNTY2NCAxNy43ODUgMTEuODA5IDI4LjQ0OSAxMS43ODUgMjIuMjI3IDAgNDAuMjYyLTE4LjAwNCA0MC4yNjItNDAuMjM0IDAtMTAuNjg0LTQuMjQ2MS0yMC45MDItMTEuNzgxLTI4LjQ3My03LjU3ODEtNy41MzkxLTE3Ljc5Ny0xMS43ODUtMjguNDg0LTExLjc4NXoiLz4KICA8cGF0aCBkPSJtMjA3LjU5IDMzNS45NmMtMTAuNjYgMC0yMC45MDYgNC4yMjY2LTI4LjQ3NyAxMS43ODktNy41MzUyIDcuNTM1Mi0xMS43NzcgMTcuNzg1LTExLjc3NyAyOC40NzcgMCAxMC42NTYgNC4yNDYxIDIwLjkxIDExLjgwOSAyOC40NDEgNy41NDMgNy41NDY5IDE3Ljc4NSAxMS43ODUgMjguNDQ5IDExLjc4NSAyMi4yMjcgMCA0MC4yNjItMTggNDAuMjYyLTQwLjIzIDAtMTAuNjk1LTQuMjQ2MS0yMC45MTgtMTEuNzgxLTI4LjQ4LTcuNTc4MS03LjUyNzMtMTcuNzk3LTExLjc4MS0yOC40ODQtMTEuNzgxeiIvPgogIDxwYXRoIGQ9Im0yMDcuNTkgMjA5LjQ4Yy0xMC42NiAwLTIwLjkwNiA0LjI1LTI4LjQ1MyAxMS43ODUtNy41NTg2IDcuNTYyNS0xMS44MDkgMTcuNzgxLTExLjgwOSAyOC40NjkgMCAxMC42NjQgNC4yNSAyMC45MTggMTEuNzc3IDI4LjQ3NyA3LjU3NDIgNy41MzUyIDE3LjgxNiAxMS43ODkgMjguNDggMTEuNzg5IDEwLjY4NCAwIDIwLjkwMi00LjI1MzkgMjguNDc3LTExLjgyIDcuNTM1Mi03LjUzNTIgMTEuNzgxLTE3Ljc4NSAxMS43ODEtMjguNDQ5IDAuMDAzOTA2LTIyLjIxOS0xOC4wMjctNDAuMjUtNDAuMjU0LTQwLjI1eiIvPgogPC9nPgo8L3N2Zz4K);
        background-size: cover;
        height: 28px;
        width: 28px;
        background-color: var(--background-hover);
        margin-right: 8px;
        position: relative;
        bottom: 1px;
      }

      #sidebar-title {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        display: flex;
        align-items: center;
        padding-left: 14px;
        padding-top: 14px;
        padding-bottom: 14px;
        color: var(--color-secondary);
        background: var(--background);
      }

      #button-container {
        width: 100%;
      }

      #sidebar button {
        border: 0;
        padding: 10px;
        cursor: pointer;
        background: var(--background);
        color: var(--color-secondary);
        border-radius: 6px;
        width: 80%;
        margin: 5px auto;
        display: block;
        font-size: var(--font-size);
      }

      #sidebar button:hover {
        background: var(--background-hover);
      }

      #files {
        margin: 0;
        max-height: 89vh;
        overflow: scroll;
      }

      #files > li {
        width: 100%;
        padding: 14px;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
      }

      #files .active {
        background: var(--background-active);
        color: var(--color);
      }

      #files > li:hover {
        background: var(--background-hover);
        cursor: pointer;
      }

      #editor {
        line-height: var(--line-height);
        resize: none;
        display: inline-block;
        width: 80%;
        border-left: 3px solid var(--border);
        height: 100%;
        margin: 0 auto;
        border: 0;
        background: var(--background);
        color: var(--color);
        font-size: var(--font-size);
        padding: 65px calc(100px + 10%) 40px;
      }

      #editor:focus {
        outline: none;
      }

      @media screen and (max-width: 1000px) {
        #sidebar {
          display: none;
        }

        #sidebar.show-mobile {
          display: block;
        }

        #editor.hide-mobile {
          display: none;
        }

        #sidebar,
        #editor {
          width: 100%;
        }

        #editor {
          padding-left: 14px;
          padding-right: 14px;
        }
      }
    </style>
  </head>
  <body>
    <div id="container">
      <strong id="sidebar-title">
        <span id="sidebar-icon"></span>
        Notes
      </strong>
      <div id="sidebar">
        <ul id="files"></ul>
        <div id="button-container">
          <button id="add">+ New Note</button>
        </div>
      </div>
      <textarea id="editor"></textarea>
    </div>
    <script>
      function Note(note = {}) {
        return {
          title() {
            return note.Data.split("\n")[0].replace("# ", "") || "New Note";
          },
          ID() {
            return note.ID;
          },
          isActive() {
            return note.Active;
          },
          content() {
            return note.Data;
          },
          toJSON() {
            return JSON.stringify(note);
          },
          update(data) {
            return Note({
              ...note,
              Data: data,
            });
          },
          setActive(active) {
            return Note({
              ...note,
              Active: active,
            });
          },
        };
      }

      function LocalStorageNotes(data = []) {
        return {
          get(note) {
            return data.find((n) => n.ID() === note.ID());
          },
          save(note) {
            localStorage.setItem(note.ID(), note.toJSON());
          },
          set(note) {
            this.save(note);
            return LocalStorageNotes(
              data.map((n) => (n.ID() === note.ID() ? note : n))
            );
          },
          init() {
            ids = JSON.parse(localStorage.getItem("IDS")) || [];

            return LocalStorageNotes(
              ids.map((id) => Note(JSON.parse(localStorage.getItem(id))))
            );
          },
          list() {
            return data;
          },
          nextID() {
            return data.length + 1 || 1;
          },
          add(note) {
            const updated = [...data, note];
            const ids = updated.map((n) => n.ID());
            localStorage.setItem("IDS", JSON.stringify(ids));
            this.save(note);
            return LocalStorageNotes(updated);
          },
          activate(note) {
            const updated = data.map(function (n) {
              if (n.ID() === note.ID()) {
                return n.setActive(true);
              }
              return n.setActive(false);
            });

            updated.forEach((n) => this.save(n));

            return LocalStorageNotes(updated);
          },
          getActive() {
            return data.find((n) => n.isActive());
          },
        };
      }

      function Sidebar(element = document.getElementById("sidebar")) {
        return {
          toggle() {
            element.classList.toggle("show-mobile")
          },
        };
      }

      function Editor(element = document.getElementById("editor")) {
        return {
          setContent(content) {
            element.value = content;
          },
          onChange(fn) {
            element.addEventListener("input", fn);
          },
          focus() {
            element.focus();
          },
          toggle() {
            element.classList.toggle("hide-mobile");
          },
        };
      }

      function Files(element = document.getElementById("files")) {
        return {
          reset() {
            while (element.firstChild) {
              element.removeChild(element.firstChild);
            }
          },
          add(file) {
            element.appendChild(file.element());
          },
        };
      }

      function File(element = document.createElement("li")) {
        return {
          setActive() {
            element.classList.add("active");
          },
          setTitle(title) {
            element.innerHTML = title;
          },
          onClick(fn) {
            element.addEventListener("click", fn);
          },
          element() {
            return element;
          },
        };
      }

      let notes = LocalStorageNotes().init();
      let editor = Editor();
      let files = Files();
      let sidebar = Sidebar();

      editor.onChange(function (e) {
        notes = notes.set(notes.getActive().update(e.target.value));
        render();
      });

      function render() {
        files.reset();

        for (const note of notes.list()) {
          const file = File();
          file.setTitle(note.title());

          if (note.isActive()) {
            file.setActive();
            editor.setContent(note.content());
          }

          file.onClick((e) => {
            notes = notes.activate(note);
            sidebar.toggle();
            editor.toggle();
            render();
          });

          files.add(file);
        }

        editor.focus();
      }

      document
        .getElementById("sidebar-icon")
        .addEventListener("click", function (e) {
          sidebar.toggle();
          editor.toggle();
        });

      document.getElementById("add").addEventListener("click", function (e) {
        const note = Note({
          ID: notes.nextID(),
          Name: "New Note",
          Data: "",
          Active: false,
        });
        notes = notes.add(note);

        render();
      });

      render();
    </script>
  </body>
</html>
